# See host/python/example_testinput.txt for info about the format of this file
# intended to be read by host/python/testhost.py

# This script tests a QRPLabs QMX or QMX+ radio connected to the computer via a
# single USB-C connection that provides both audio and CAT control.  It should
# be relatively easy to create a variant of this script to test other radios
# that provide a similar interface.

# Instead of using plughw based alsa audio devices, this test uses pulse.
# The pulse device differs from other alsa audio devices, including plughw
# as used on a computer running Pulse Audio, in that they remain usable even
# when no actual physical audio device is available.  Thus, unlike when other
# audio devices are used, ardopcf does not automatically switch to RXENABLED
# FALSE and TXENABLED FALSE.  Instead, received audio is silence when the
# physical audio device is not available.  So, a single test of turning the
# QMX off and back on is used to confirm that RXENABLED and TXENABLED remain
# TRUE.  Then, the remaining tests relate only to intentionally disabling
# the audio (and PTT) devices.  This test will fail on a Linux computer where
# the pulse devices are not available.

# This script tests the behavior of several host commands intended to query and
# modify the audio/PTT/CAT configuration of ardopcf.  It should be initiated
# after starting ardopcf without configuring any audio, PTT, or CAT devices.

!!print For the following, the radio used should be connected to a dummy load.
!!print You must be able to detect whether a radio has transmitted.
!!print Ideally, do this with a radio receiver close to the dummy load so that
!!print you can hear the signal.  Watching measures of power output from the
!!print radio or a meter between the transmitter and the dummy load is almost as
!!print good when using a SSB transceiver since audio is required to produce any
!!print power.  Watching only a PTT indicator or hearing a PTT relay on the
!!print radio is less desirable since it confirms PTT action but does not
!!print confirm that TX audio is produced.  A message like "** OK if PTT engaged
!!print and audio was transmitted. [QMX1] **" is printed each time a
!!print transmission is made.  If there was no indication that the radio
!!print transmitted when you see this, press CTRL-C to stop the testing and
!!print investigate the reason for the failure.  The text in square brackets at
!!print the end of this message is there to help you identify where in this
!!print script the failure occured.  This message is always followed by a
!!print request to do something such as disconnecting or turning off a radio, or
!!print a request to press a key.  This should be done AFTER the end of the
!!print transmission.  You may open an instance of the WebGUI in a browser
!!print window and use the "Show Config Controls" button to monitor how the
!!print display changes during this test.  However, do not use those controls
!!userwait to make any changes while the test is running.

# Setting CONSOLELOG 1 produces STATUS host commands when RXENABLED, TXENABLED,
# and PTTENABLED are changed to FALSE due to a failure.  Setting it to 1 (or 2)
# also ensures that an INPUTPEAKS message is sent to the host every 10 seconds.
!CONSOLELOG 1
!!qexpect CONSOLELOG now 1

# SENDID is used to test ability to control PTT and play audio.  So, set CWID
# to false so that additional TX is not produced to also send a CW ID after the
# IDFrame
!CWID FALSE
!!qexpect CWID now FALSE

# Set wait timeout to 12.0 seconds.  This does not affect !!qwaitforinputpeaks
# which uses a hard coded limit of 11.0 seconds rather that this value.
!!timeout 12.0

# MYCALL must be set to enable TX to verify that TX audio and PTT are working
!MYCALL AI7YN
!!qexpect MYCALL now AI7YN

# This test is only expected to work for ardopcf version 1.x
!VERSION
!!qexpect .*VERSION ardopcf_1\..*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RADIOPTTON
!!qexpect RADIOPTTON VALUE NOT SET
!RADIOPTTOFF
!!qexpect RADIOPTTOFF VALUE NOT SET

!!print \nInitial configuration is OK.\n
!!userwait ** Connect the QMX to the computer with a USB cable and turn it on. [QMX1] **

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!CAPTUREDEVICES
!!qexpect (?s).*pulse.*
!CAPTURE pulse
!!qexpect CAPTURE now pulse

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

# Verify RX enabled by waiting for INPUTPEAKS
!!qwaitforinputpeaks

!PLAYBACKDEVICES
!!qexpect (?s).*pulse.*
!PLAYBACK pulse
!!qexpect PLAYBACK now pulse

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00
!!qexpect RADIOCTRLPORT now /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

# Check all status values
## PTTENABLED is still FALSE because both RADIOPTTON and RADIOPTTOFF are not yet set
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!RADIOPTTON
!!qexpect RADIOPTTON VALUE NOT SET
!RADIOPTTOFF
!!qexpect RADIOPTTOFF VALUE NOT SET

!RADIOPTTON 54583B
!!qexpect RADIOPTTON now 54583B
!RADIOPTTON
!!qexpect RADIOPTTON 54583B
!RADIOPTTOFF
!!qexpect RADIOPTTOFF VALUE NOT SET

# Check all status values
## PTTENABLED is still FALSE because both RADIOPTTON and RADIOPTTOFF are not yet set
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!RADIOPTTOFF 52583B
!!qexpect RADIOPTTOFF now 52583B
!RADIOPTTOFF
!!qexpect RADIOPTTOFF 52583B
!RADIOPTTON
!!qexpect RADIOPTTON 54583B

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

# When a device is already enabled, setting it to RESTORE should do nothing

!CAPTURE RESTORE
!!qexpect CAPTURE now pulse

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!PLAYBACK RESTORE
!!qexpect PLAYBACK now pulse

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!RADIOCTRLPORT RESTORE
!!qexpect RADIOCTRLPORT now /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

# Trying to restore something that hasn't ever been set fails
!RADIOPTT RESTORE
!!qexpect FAULT RADIOPTT cannot be set to RESTORE.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!SENDID
!!qexpect SENDID
# SENDID takes about 1.6 seconds.  So, use !!waitms 1800 to wait until it should
# have finished playing before rechecking status values.  This way, if a problem
# occurs during KeyPTT(TRUE), playback, or KeyPTT(FALSE), the effects will be
# observed with these checks.
!!waitms 1800

# Check all status values
## If there was a problem in TX audio or PTT control, it might be detected when
## attempting to transmit
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!!print ** OK if PTT engaged and audio was transmitted. [QMX2] **
!!print ** Turn QMX off to continue test.  Unlike most other tests, On some
!!print ** (most?) systems, ardopcf will not detect this action itself.
!!print ** On those systems, if the WebGUI is active, the RXAudio field near the
!!print ** top left corner will change from ENABLED (highlighted in green)
!!print ** to SILENT (highlighted in yellow).  Unfortunately, on some systems
!!print ** including a 32-bit ARM system tested, the response to turning off
!!print ** an audio device in use is unpredicable.  Sometimes it is detected,
!!print ** and RESTORE can be used to continue operation after it is
!!print ** turned back on.  Other (random) times, ardopcf will lock up when a pulse
!!print ** audio device is turned off while in use.  When this occurs, ardopcf
!!print ** cannot be stopped with CTRL-C.  If this occurs, from another console
!!print ** connection, run ps -e | grep ardopcf to get the process id.  Then run
!!print ** kill -9 NNN, where NNN is the process id found.  A solution to detect
!!userwait ** this problem and respond better has not been found.

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

# Verify RX is still enabled by waiting for INPUTPEAKS
!!qwaitforinputpeaks

# While loss of RX and TX are not detected, loss of CAT control is
# detected with an attempt to TX.
!SENDID
!!qwaitforall SENDID||STATUS PTTENABLED FALSE
!!waitms 1800

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!PTTENABLED TRUE
!!qexpect FAULT PTTENABLED cannot be set to TRUE\..*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RADIOCTRLPORT RESTORE
!!qexpect FAULT RADIOCTRLPORT cannot be set to RESTORE.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RADIOPTT RESTORE
!!qexpect FAULT RADIOPTT cannot be set to RESTORE.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

# Failed attempts to set RADIOCTRLPORT and RADIOPTT should
# also have no effect on later use of RESTORE or *ENABLED TRUE.

!RADIOCTRLPORT Anything invalid
!!qexpect FAULT RADIOCTRLPORT cannot be set to Anything invalid.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RADIOPTT Anything invalid
!!qexpect FAULT RADIOPTT cannot be set to Anything invalid.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!!userwait ** Turn QMX back on. [QMX3] **

# Verify RX enabled by waiting for INPUTPEAKS
!!qwaitforinputpeaks

!RADIOCTRLPORT RESTORE
!!qwaitfor RADIOCTRLPORT now /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!SENDID
!!qexpect SENDID
!!waitms 1800

# Check all status values
## If there was a problem in TX audio or PTT control, it might be detected when
## attempting to transmit
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!!print ** OK if PTT engaged and audio was transmitted.
!!userwait Turn QMX off. [QMX4] **

# Turn off and back on without doing SENDID so that loss of CAT control is
# not detected.

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

# Verify RX is still enabled by waiting for INPUTPEAKS
!!qwaitforinputpeaks

!!userwait Turn QMX back on. [QMX5] **

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!SENDID
# This should fail because RADIOCTRLPORT was lost.  The device is available
# again now, but must be closed and reopened before it can be used.
!!qexpect SENDID
!!waitms 1800

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RADIOCTRLPORT RESTORE
!!expect RADIOCTRLPORT now /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!SENDID
!!qexpect SENDID
# This should succeed now.
!!waitms 1800

# Check all status values
## If there was a problem in TX audio or PTT control, it might be detected when
## attempting to transmit
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!!userwait ** OK if PTT engaged and audio was transmitted. [QMX8] (QMX6-7 skipped)**


################################################################################
# Repeat the above tests, but using CODEC FALSE, and PTTENABLED FALSE rather
# than turning off the radio
################################################################################

!CODEC FALSE
!!qexpect CODEC now FALSE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!PTTENABLED FALSE
!!qexpect PTTENABLED now FALSE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

# Failed attempts to set CAPTURE, PLAYBACK, RADIOCTRLPORT, and RADIOPTT should
# have no effect on later use of RESTORE or *ENABLED TRUE.

!CAPTURE Anything invalid
!!qexpect FAULT Cannot open CaptureDevice as configured:.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!PLAYBACK Anything invalid
!!qexpect FAULT Cannot open PlaybackDevice as configured:.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RADIOCTRLPORT Anything invalid
!!qexpect FAULT RADIOCTRLPORT cannot be set to Anything invalid.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RADIOPTT Anything invalid
!!qexpect FAULT RADIOPTT cannot be set to Anything invalid.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!!print ** RESTORE QMX. [QMX9] **

# Use RESTORE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!CAPTURE RESTORE
!!qwaitfor CAPTURE now pulse

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

# Verify RX enabled by waiting for INPUTPEAKS
!!qwaitforinputpeaks

!PLAYBACK RESTORE
!!qwaitfor PLAYBACK now pulse

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RADIOCTRLPORT RESTORE
!!qwaitfor RADIOCTRLPORT now /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!SENDID
!!qexpect SENDID
!!waitms 1800

# Check all status values
## If there was a problem in TX audio or PTT control, it might be detected when
## attempting to transmit
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!!userwait ** OK if PTT engaged and audio was transmitted. [QMX10] **

!CODEC FALSE
!!qexpect CODEC now FALSE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!PTTENABLED FALSE
!!qexpect PTTENABLED now FALSE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!!print ** RESTORE QMX. [QMX11] **

# Use RX/TXENABLED TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RXENABLED TRUE
!!qwaitfor RXENABLED now TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

# Verify RX enabled by waiting for INPUTPEAKS
!!qwaitforinputpeaks

!TXENABLED TRUE
!!qwaitfor TXENABLED now TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!PTTENABLED TRUE
!!qwaitfor PTTENABLED now TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!SENDID
!!qexpect SENDID
!!waitms 1800

# Check all status values
## If there was a problem in TX audio or PTT control, it might be detected when
## attempting to transmit
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!!userwait ** OK if PTT engaged and audio was transmitted. [QMX12] **

!CODEC FALSE
!!qexpect CODEC now FALSE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!PTTENABLED FALSE
!!qexpect PTTENABLED now FALSE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!!print ** RESTORE QMX. [QMX13] **

# Use CODEC TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!CODEC TRUE
!!qwaitfor CODEC now TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

# Verify RX enabled by waiting for INPUTPEAKS
!!qwaitforinputpeaks

!PTTENABLED TRUE
!!qwaitfor PTTENABLED now TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!SENDID
!!qexpect SENDID
!!waitms 1800

# Check all status values
## If there was a problem in TX audio or PTT control, it might be detected when
## attempting to transmit
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!!userwait ** OK if PTT engaged and audio was transmitted. [QMX14] **

################################################################################
# Repeat the above tests, but using RXENABLED FALSE, TXENABLED FALSE, and
# PTTENABLED FALSE rather than turning off the radio or CODEC FALSE
################################################################################

!RXENABLED FALSE
!!qexpect RXENABLED now FALSE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!TXENABLED FALSE
!!qexpect TXENABLED now FALSE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!PTTENABLED FALSE
!!qexpect PTTENABLED now FALSE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

# Failed attempts to set CAPTURE, PLAYBACK, RADIOCTRLPORT, and RADIOPTT should
# have no effect on later use of RESTORE or *ENABLED TRUE.

!CAPTURE Anything invalid
!!qexpect FAULT Cannot open CaptureDevice as configured:.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!PLAYBACK Anything invalid
!!qexpect FAULT Cannot open PlaybackDevice as configured:.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RADIOCTRLPORT Anything invalid
!!qexpect FAULT RADIOCTRLPORT cannot be set to Anything invalid.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RADIOPTT Anything invalid
!!qexpect FAULT RADIOPTT cannot be set to Anything invalid.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!!print ** RESTORE QMX. [QMX15] **

# Use RESTORE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!CAPTURE RESTORE
!!qwaitfor CAPTURE now pulse

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

# Verify RX enabled by waiting for INPUTPEAKS
!!qwaitforinputpeaks

!PLAYBACK RESTORE
!!qwaitfor PLAYBACK now pulse

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RADIOCTRLPORT RESTORE
!!qwaitfor RADIOCTRLPORT now /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!SENDID
!!qexpect SENDID
!!waitms 1800

# Check all status values
## If there was a problem in TX audio or PTT control, it might be detected when
## attempting to transmit
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!!userwait ** OK if PTT engaged and audio was transmitted. [QMX16] **

!RXENABLED FALSE
!!qexpect RXENABLED now FALSE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!TXENABLED FALSE
!!qexpect TXENABLED now FALSE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!PTTENABLED FALSE
!!qexpect PTTENABLED now FALSE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!!print ** RESTORE QMX. [QMX17] **

# Use RX/TXENABLED TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RXENABLED TRUE
!!qwaitfor RXENABLED now TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

# Verify RX enabled by waiting for INPUTPEAKS
!!qwaitforinputpeaks

!TXENABLED TRUE
!!qwaitfor TXENABLED now TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!PTTENABLED TRUE
!!qwaitfor PTTENABLED now TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!SENDID
!!qexpect SENDID
!!waitms 1800

# Check all status values
## If there was a problem in TX audio or PTT control, it might be detected when
## attempting to transmit
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!!userwait ** OK if PTT engaged and audio was transmitted. [QMX18] **

!RXENABLED FALSE
!!qexpect RXENABLED now FALSE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!TXENABLED FALSE
!!qexpect TXENABLED now FALSE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!PTTENABLED FALSE
!!qexpect PTTENABLED now FALSE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!!print ** RESTORE QMX. [QMX19] **

# Use CODEC TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!CODEC TRUE
!!qwaitfor CODEC now TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

# Verify RX enabled by waiting for INPUTPEAKS
!!qwaitforinputpeaks

!PTTENABLED TRUE
!!qwaitfor PTTENABLED now TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!SENDID
!!qexpect SENDID
!!waitms 1800

# Check all status values
## If there was a problem in TX audio or PTT control, it might be detected when
## attempting to transmit
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!!userwait ** OK if PTT engaged and audio was transmitted. [QMX20] **

################################################################################
# Repeat the above tests, but using CAPTURE NONE, PLAYBACK NONE,
# RADIOCTRLPORT NONE, RADIOPTT NONE rather than turning off the radio or CODEC
# FALSE or RXENABLED FALSE, TXENABLED FALSE, and  PTTENABLED FALSE
################################################################################

!CAPTURE NONE
!!qexpect FAULT Cannot open CaptureDevice as configured: CAPTURE NONE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!PLAYBACK NONE
!!qexpect FAULT Cannot open PlaybackDevice as configured: PLAYBACK NONE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!RADIOCTRLPORT NONE
!!qwaitforall STATUS PTTENABLED FALSE||RADIOCTRLPORT now NONE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

# Failed attempts to set CAPTURE, PLAYBACK, RADIOCTRLPORT, and RADIOPTT should
# have no effect on later use of RESTORE or *ENABLED TRUE.

!CAPTURE Anything invalid
!!qexpect FAULT Cannot open CaptureDevice as configured:.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!PLAYBACK Anything invalid
!!qexpect FAULT Cannot open PlaybackDevice as configured:.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RADIOCTRLPORT Anything invalid
!!qexpect FAULT RADIOCTRLPORT cannot be set to Anything invalid.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RADIOPTT Anything invalid
!!qexpect FAULT RADIOPTT cannot be set to Anything invalid.*

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!!print ** RESTORE QMX. [QMX21] **

# Use RESTORE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!CAPTURE RESTORE
!!qwaitfor CAPTURE now pulse

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

# Verify RX enabled by waiting for INPUTPEAKS
!!qwaitforinputpeaks

!PLAYBACK RESTORE
!!qwaitfor PLAYBACK now pulse

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RADIOCTRLPORT RESTORE
!!qwaitfor RADIOCTRLPORT now /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!SENDID
!!qexpect SENDID
!!waitms 1800

# Check all status values
## If there was a problem in TX audio or PTT control, it might be detected when
## attempting to transmit
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!!userwait ** OK if PTT engaged and audio was transmitted. [QMX22] **

!CAPTURE NONE
!!qexpect FAULT Cannot open CaptureDevice as configured: CAPTURE NONE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!PLAYBACK NONE
!!qexpect FAULT Cannot open PlaybackDevice as configured: PLAYBACK NONE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!RADIOCTRLPORT NONE
!!qwaitforall STATUS PTTENABLED FALSE||RADIOCTRLPORT now NONE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!!print ** RESTORE QMX. [QMX23] **

# Use RX/TXENABLED TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!RXENABLED TRUE
!!qwaitfor RXENABLED now TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

# Verify RX enabled by waiting for INPUTPEAKS
!!qwaitforinputpeaks

!TXENABLED TRUE
!!qwaitfor TXENABLED now TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!PTTENABLED TRUE
!!qwaitfor PTTENABLED now TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!SENDID
!!qexpect SENDID
!!waitms 1800

# Check all status values
## If there was a problem in TX audio or PTT control, it might be detected when
## attempting to transmit
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!!userwait ** OK if PTT engaged and audio was transmitted. [QMX24] **

!CAPTURE NONE
!!qexpect FAULT Cannot open CaptureDevice as configured: CAPTURE NONE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!PLAYBACK NONE
!!qexpect FAULT Cannot open PlaybackDevice as configured: PLAYBACK NONE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!RADIOCTRLPORT NONE
!!qwaitforall STATUS PTTENABLED FALSE||RADIOCTRLPORT now NONE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!!print ** RESTORE QMX. [QMX25] **

# Use CODEC TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED FALSE
!TXENABLED
!!qwaitfor TXENABLED FALSE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC FALSE
!CAPTURE
!!qwaitfor CAPTURE NONE
!PLAYBACK
!!qwaitfor PLAYBACK NONE
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

!CODEC TRUE
!!qwaitfor CODEC now TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED FALSE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT NONE

# Verify RX enabled by waiting for INPUTPEAKS
!!qwaitforinputpeaks

!PTTENABLED TRUE
!!qwaitfor PTTENABLED now TRUE

# Check all status values
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!SENDID
!!qexpect SENDID
!!waitms 1800

# Check all status values
## If there was a problem in TX audio or PTT control, it might be detected when
## attempting to transmit
!RXENABLED
!!qwaitfor RXENABLED TRUE
!TXENABLED
!!qwaitfor TXENABLED TRUE
!PTTENABLED
!!qwaitfor PTTENABLED TRUE
!CODEC
!!qwaitfor CODEC TRUE
!CAPTURE
!!qwaitfor CAPTURE pulse
!PLAYBACK
!!qwaitfor PLAYBACK pulse
!RADIOPTT
!!qwaitfor RADIOPTT NONE
!RADIOCTRLPORT
!!qwaitfor RADIOCTRLPORT /dev/serial/by-id/usb-QRP_Labs_QMX_Transceiver-if00

!!userwait ** OK if PTT engaged and audio was transmitted. [QMX26] **

!!print ** Done.  QMX test successful. **
!CLOSE
!!quit
